<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/estilos.css">
    <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
    <script src="node_modules/xterm/lib/xterm.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/3.14.5/xterm.min.js"></script>
    <title>CBUILDER</title>
</head>

<body>
    <header>
        <h1><a href="index.html">CBUILDER</a></h1>
        <div>
            <a href="./index.html">Simple</a>
            <a href="./compound.html">Compound services</a>
            <a href="./plans.html">Become a builder</a>
        </div>
    </header>
    <section id="layout">
        <div id="terminal"></div>
        <script>
          var term = new Terminal({
              cursorBlink: "block"
          });
          const ws = new WebSocket("ws://localhost:3000", "echo-protocol");
          var curr_line = "";
          var entries = [];
          term.open(document.getElementById('terminal'));
          term.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ')

          term.on("key", function(key, ev) {
              curr_line += key;
              term.write(key);
          });

          term.prompt = () => {
              if (curr_line) {
                  let data = { method: "command", command: curr_line };
                  ws.send(JSON.stringify(data));
              }
          };
          term.prompt();

          //receive data from socket
          ws.onmessage = msg => {
              term.write("\r\n" + JSON.parse(msg.data).data);
              curr_line = "";
          };
          term.on("key", function(key, ev) {
              if (ev.keyCode === 13) {
                  if (curr_line) {
                      entries.push(curr_line);
                      term.write("\r\n");
                      term.prompt();
                  }
              } else {
                  curr_line += key;
                  term.write(key);
              }
          });
        </script>
    </section>
</body>

</html>